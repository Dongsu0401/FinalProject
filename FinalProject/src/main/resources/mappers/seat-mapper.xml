<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="seatMapper">
  	
  	<select id="countSeat" resultType = "_int">
  		SELECT COUNT(*) 
		FROM STUDYSEAT
		WHERE SS_USE = 'N'
		GROUP BY SS_FLOOR
  	</select>
  	
  	<select id = "selectFloorSeat" parameterType = "string" resultType = "Seat">
  		SELECT *
  		FROM STUDYSEAT
  		WHERE SS_FLOOR = #{floor}
  	</select>
  	
  	<update id = "updateResv" parameterType = "Seat">
  		UPDATE STUDYSEAT
  		SET SS_USE = 'R' , CERT_CODE = #{cert_code} , STUDENT_ID = #{student_id}
  		WHERE SS_NO = #{ss_no} 
  	</update>
  
  	<select id = "checkDup" parameterType = "string" resultType = "_int">
  		SELECT COUNT(*)
  		FROM STUDYSEAT
  		WHERE STUDENT_ID = #{id}
  	</select>
  	
  	<resultMap id = "seatResultSet" type = "Seat">
  		<id property="ss_no" column="SS_NO"/>
  		<result property="ss_floor" column="SS_FLOOR"/>
  		<result property="ss_use" column="SS_USE"/>
  		<result property="ss_cert" column = "SS_CERT"/>
  		<result property="cert_code" column="CERT_CODE"/>
  		<result property="student_id" column="STUDENT_ID"/>
  		<result property="start_Time" column="START_TIME"/>
  		<result property="end_time" column="END_TIME"/>
  	</resultMap>
  	
  	<resultMap id = "historyResultSet" type = "SeatHistory">
  		<id property="shNo" column="SH_NO"/>
  		<result property="useDate" column = "USE_DATE"/>
  		<result property="shStatus" column="SH_STATUS"/>
  		<collection property="seat" resultMap="seatResultSet"/>
  	</resultMap>
  	
  	<select id = "selectHistoryList" parameterType="string" resultMap="historyResultSet">
  		SELECT *
		FROM SEAT_HISTORY SH
		JOIN STUDYSEAT S ON (SH.SS_NO = S.SS_NO)
		WHERE SH.STUDENT_ID = #{id}
		ORDER BY USE_DATE DESC
  	</select>
  
  	
</mapper>
